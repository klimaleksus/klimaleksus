<!doctype html><html><head><meta charset="utf-8"><title>OwlParser v1.0!</title></head>
<body><form id="myid">

<textarea id="forum" style="width:95%;height:128px;"></textarea><br>
<input type="button" onclick="FORUM();" value="PARSE!">
<div id="result"></div>

<script>
function htmlEntities(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

function owl(text){
var t,r,i,m,a;
t='\n'+text+'\n';
t=t.

replace(/\t|\n/g,'•'). // Табуляторы делаем переносами, чтобы из таблиц Ворда вставлять. Символ «•» далее – перенос.
replace(/\s+/g,' '). // Много пробельных символов = один пробел.
replace(/\s?•\s?/g,'•'). // Убрать пробелы на началах и концах строк.
replace(/•+/g,'•'). // Убрать все пыстые строки.
replace(/\s*\[\s*/g,'['). // Убрать пробелы до и после «[».
replace(/\s*\]\s*/g,']'). // Также и с «]», на игровую «&[» вроде не влитяет…
replace(/•\[/g,'•'). // Убрать «[», если она в начале строки.
replace(/([0-9][0-9]+)\s*\]/g,'$1 '). // Если где-то есть не менее двух цифр в цифровом ряду, после которого, возможно через пробел, идёт «]» – то оставить там только цифры и отделить пробелом.
replace(/([0-9][0-9]+)(\s|•)+/g,'$1 '). // Если после цифр есть пробелы или переносы строк подряд – то убрать перенос, и опять же оставить пробел.
replace(/^\s*([0-9][0-9]+\s[^а-яА-Я]*?)\s([а-яА-Я])/g,'$1\n$2'). // Есть есть строка, в начале которой, (за игнорированием пробелов) стоит не менее двух цифр в цифровом ряду, после которого идут пробелы, а далее – любые символы кроме русских букв,  после которых возникает момент, что через пробельчик появляется русская буква – то заменить этот самый пробельчик на перенос строки.
replace(/•/g,'\n'). // Восстановить настоящие переносы.

replace('','');
r=[];
a=t.split('\n');
a.push('');
for(i=0;i<a.length-1;i++){ // Цикл по всем получившимся строчкам.
m=a[i].replace(/^([0-9][0-9]+) (.*)$/g,'$1\n$2').split('\n'); // Если в начале строки стоят хотя бы две цифры, то после всего этого числа – то разбить это на массив так, что в первый элемент попадёт число, а во второй – всё остальное правее.
if(m.length>1){// Есть разбивка произошла:
i++;
r.push([m[0],m[1],a[i].replace(/^([0-9][0-9]+)\s+/,'')]); // Помещаем результат: число и  изначальную строку – вместе со следующей строчкой результата, но удалив из неё число в начале, если оно есть.
}}
return r; // Выводить «t» или «t.replace(/\n/g,'<br>')» для отладки!
}

function FORUM(){
var r,d,i;

r=owl(document.getElementById('forum').value);

d='';
d+='<table border="1">';
for(i=0;i<r.length;i++){
d+='<tr>';
d+='<td>'+htmlEntities(r[i][0])+'</td>';
d+='<td>'+htmlEntities(r[i][1])+'</td>';
d+='<td>'+htmlEntities(r[i][2])+'</td>';
d+='</tr>';
}
d+='</table>';

document.getElementById('result').innerHTML=d;
};
F();
</script>


<script>var t=document.title,a,i;a=document.scripts;for(i=0;i<a.length;i++)a[i].outerHTML='';a=document.body.childNodes;for(i=0;i<a.length;i++)if(a[i].id!='myid')a[i].outerHTML='';a=setInterval(function(){},1);for(i=0;i<a;i++)clearInterval(i);a=setTimeout(function(){},1);for(i=0;i<a;i++)clearTimeout(i);document.title=t;</script></form><noscript style="display:none"><xmp style="display:none"></body></html>
